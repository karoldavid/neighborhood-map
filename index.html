<!-- Declare Application as HTML 5 for better Browser Compatibility
     https://developers.google.com/maps/documentation/javascript/tutorial -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Performing Arts Map Application">
    <meta name="author" content="Karol Zyskowski">
    <title>Performing Arts Map</title>
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Architects+Daughter">
    <link rel="stylesheet" href="css/style.css">
  </head>

  <body>
    <div class="flex-container">
      <header>
        <div class="item-1">
          <h1 data-bind="text: region, attr: {title: distance}"></h1>
          <p>skyZoom</p>
        </div>

        <div class="item-2">
          <form action="#">
            <input class="rounded-corners" placeholder="Search skyZoomâ€¦" type="search" name="q" data-bind="textInput: query" autocomplete="off">
            <button id="resetButton" class="function-button" title="reset" data-bind="click: resetSearch">X</button>
            <button class="function-button reverse" title="reverse" data-bind="click: reverseList"><></button>
          </form>
        </div>

        <div class="item-3">
          <p data-bind="text: weather" title="http://openweathermap.org/"></p>
        </div>

        <div class="item-4">
          <a id="menu" class="hamburger" title="menu">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path d="M2 6h20v3H2zm0 5h20v3H2zm0 5h20v3H2z"/>
            </svg>
          </a>
        </div>
      </header>

      <div class="map-container">
        <div id="map-canvas" class="full-map" data-bind="map: myMap"></div>
      </div>

      <main>
        <div class="row">

          <div class="col-1 search-list">
            <div class="item-1 vertical-container">

              <!-- Show selected Focus Button as text -->
                <div class="item-1 flex1 category">
                  <p>Selected: <span data-bind="text: $root.chosenFocusId() || 'All'"></span><span data-bind="visible: $root.chosenFocusId() == 'POI', text: ' = Performing Arts'"></span></p>
                </div> <!-- TODO: Get POI dynamically -->

                <div id="hide-list" class="arrow-left item-2 flex2" title="hide"></div>
            </div>

            <div class="item-2 search-suggestions">
              <ul class="vertical-container" data-bind="template: {name: 'focusGroup', foreach: focusButtons()}"></ul>
            </div>

            <div class="item-3 search-results">
              <!-- TODO: Scroll to activated list item -->
              <!-- TODO: Message "nothing found" -->
              <ul data-bind="template: {name: 'result', foreach: searchResults}"></ul>
            </div>
          </div>

          <div class="col-2">
            <!-- Show 'arrow right' when 'location search list' is hidden -->
          	<div id="show-list" class="show arrow-right" title="show"></div>
          	<div id="error"></div>
          </div>

          <div class="col-3">
            <div id="fs-all" class="fs-style" data-bind="with: currentLocation, visible: focus() === 'POI'">

               <!-- FourSquare POI Image Slider Gallery-->
              <div class="slider" data-bind="visible: fs_photos().length > 0">
                <h3 data-bind="text: name"></h3>
                <a class="control_next" id="next" data-bind="click: $root.chosenDirectionId">></a>
                <a class="control_prev" id="prev" data-bind="click: $root.chosenDirectionId"><</a>

                <ul>
                  <li><a class="thumbs" data-bind="attr: {href: fs_photos()[$parent.currentImage()]}" target="_blank"}>
                         <img title="Source: FourSquare" data-bind="attr: {src: fs_photos()[$parent.currentImage()]}"/>
                      </a>
                  </li>
                </ul>

              </div>

              <div id="fs-nearbyFood" data-bind="visible: fs_restaurants().length > 0">
                <h3>Nearby Restaurants</h3>
                <ul data-bind="template: {name: 'nearByFood', foreach: fs_restaurants}"></ul>
              </div>

              <div id="fs-nearbyHotels" data-bind="visible: fs_hotels().length > 0">
                <h3>Nearby Hotels</h3>
                <ul data-bind="template: {name: 'nearByHotels', foreach: fs_hotels}"></ul>
              </div>

              <div id="fs-tips" data-bind="visible: fs_tips().length > 0">
                <h3>Tips</h3>
                <ul data-bind="template: {name: 'tips', foreach: fs_tips}"></ul>
              </div>

            </div>
          </div>

          <div class="col-4 menu">

            <ul data-bind="template: {name: 'focusGroupMainMenu', foreach: focusButtons()}"></ul>

            <ul>
              <li><a id="0" class="sub-info">Wikipedia</a></li>
            </ul>

            <ul>
              <li><a id="1" class="sub-info">info</a></li>
              <li><a id="2" class="sub-info">about</a></li>
              <li><a id="3" class="sub-info">contact</a></li>
              <li><a><a href="mailto:k.zysk@zoho.com?subject=skyZoom Application" title="email to Karol Zyskowski" target="_self">&#9993;</a></a></li>
            </ul>

            <ul>
              <li><a id="4" class="sub-info">disclaimer</a></li>
            </ul>

          </div>

          <div class="col-5">

            <div id="wiki" class="wikipedia">
              <h4>Wiki about <span data-bind="text: region"></span></h4>
              <ul id="wikipedia-links" data-bind="template: {name: 'wikipediaList', foreach: wikipediaLinks}"></ul>
            </div>

            <div id="info" class="info-text">

              <h4>Information</h4>

              <p>This Application offers Production Managers in the fast paste Performing Arts Industry (Classical Music, Contemporary Dance, Theater, Musical) an easy and distraction free overview of a location where their company is going to perform in the future.</p>

              <p>They can search a location by different categories such as venue (POI = Concert Hall, Theater, Opera House, etc.) and identify nearby hotels and restaurants, or by transportation (Airport, Train Station) and the most important spots (City Center, Historic Center, Park, Library, Mall) the location has to offer.</p>

              <p>Finally their choices may be printed for further purposes.</p>

            </div>

            <div id="about" class="about-text">
              <h4>About</h4>
              <p>Idea & Programming by<br>Karol Zyskowski</p>
            </div>

            <div id="contact" class="contact-text">
              <h4>Contact</h4>
              <p>Karol Zyskowski<br>Front-End Webdeveloper<br><br>location: Berlin - Germany<br><br>email: k.zysk@zoho.com<br>phone: +49 30 301 393 71</p>
            </div>

            <div id="disclaimer" class="disclaimer-text">
              <h4>Disclaimer</h4>
              <p>Throughout our site you will find links to external websites. Although we make every effort to ensure these links are accurate, up to date and relevant, we cannot take responsibility for pages maintained by external providers.</p>
            </div>

          </div>
        </div>
      </main>
    </div>

    <!-- Search Suggestion Group Buttons for Loaction Search List -->
    <script type="text/html" id="focusGroup">
      <li><button class="suggest-button" data-bind="css: { selected: $data == $root.chosenFocusId() }, click: $root.goToFocus, attr: {title: $data}"></button></li>
    </script>

    <!-- Search Suggestion Group Buttons in right menu-->
    <script type="text/html" id="focusGroupMainMenu">
      <li><button class="suggest-button" data-bind="css: { selected: $data == $root.chosenFocusId() }, click: $root.goToFocus, attr: {title: $data}"></button><span data-bind="text: $data"></span></li>
    </script>

    <!-- Location Search Results list -->
    <script type="text/html" id="result">
      <li data-bind="css: { selected: $data == $root.chosenLocationId() }, click: $root.goToLocation, event: {mouseover: $root.mouseOverListItem, mouseout: $root.mouseOutListItem}, attr: {title: name, class: focus()}"><img data-bind="click: $root.toggleStreetView, attr:{src:img(), alt: 'Google Street View Image of ' + name, title: 'Google Street View of ' + name}"/><span class="title" data-bind="text: title"></span><span class="name" data-bind="text: name"></span></li>
    </script>

    <!-- Wikipedia Map Region Info Link List -->
    <script type="text/html" id="wikipediaList">
      <li>
        <a data-bind="attr:{href: url, title: url}, text: title" target="_blank"></a>
        <p class="block-ellipsis" data-bind="text: definition || 'no short description available'"></p>
      </li>
    </script>

    <!-- FourSquare POI nearBy Restaurants List -->
    <script type="text/html" id="nearByFood">
      <li data-bind="text: $data"></li>
    </script>

    <!-- FourSquare POI nearBy Hotels List -->
    <script type="text/html" id="nearByHotels">
      <li data-bind="text: $data"></li>
    </script>

    <!-- FourSquare POI tips List -->
    <script type="text/html" id="tips">
      <li data-bind="text: $data"></li>
    </script>

    <!-- TODO: Load Google Maps async with &callback=initialize
         https://developers.google.com/maps/documentation/javascript/tutorial
         https://developers.google.com/maps/documentation/javascript/examples/map-simple-async -->
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&key=AIzaSyDfBRThn5FwVjH451Lo-oeK-rGHsPRVzWg"></script>
    <script src="js/lib/jquery-1.11.3.js"></script>
    <script src="js/lib/knockout-3.3.0.js"></script>
    <script src="js/map-styles.js"></script>
    <script src="js/location-data.js"></script>
    <script src="js/app.js"></script>

    <script>

      /**
       *
       * Toggle, hide and show DOM elements
       *
       */

      function toggleVisibility(id) {
      	var elem = document.getElementById(id);
    	elem.style.display = ((elem.style.display!='none') ? 'none' : 'block');
      }

      function hideElement(id) {
    	var elem = document.getElementById(id);
        elem.style.display = ('none');
      }

      function showElement(id) {
        var elem = document.getElementById(id);
        elem.style.display = ('block');
      }

      /**
       *
       * DRAWERS:
       * - left Locations Search List drawer
       * - right POI FourSquare drawer
       * - right Main Menu drawer
       * - right Sub Info drawer
       */

      var menu = document.querySelector('#menu');
      var hideList = document.querySelector('#hide-list');
      var showList = document.querySelector('#show-list');
      var hidePoiDrawer = document.querySelector('#hide-poi');
      var resetButton = document.querySelector('#resetButton');
      var main = document.querySelector('main');
      var listDrawer = document.querySelector('.col-1');

      /* Hide the left location search list drawer when the hide icon '<<' is clicked */
      hideList.addEventListener('click', function(e) { // TODO: Needs to get another DOM element to open on click when closed
        listDrawer.classList.add('close');
        showElement('show-list');
        e.stopPropagation();
      });

      showList.addEventListener('click', function(e) {
      	listDrawer.classList.remove('close');
      	hideElement('show-list');
        e.stopPropagation();
      });

      var poi = document.getElementsByClassName("POI");
      var poiDrawer = document.querySelector('.col-3');

      /* Open the right POI FourSquare drawer when a POI list item is clicked */
      for(var i=0; i < poi.length; i++){
      	poi[i].addEventListener('click', function(e) {
        	showElement("fs-all");
        	if (!poiDrawer.classList.contains('open')) {
        		poiDrawer.classList.add('open');
        	}
            e.stopPropagation();
        });
      }

      var rightDrawer = document.querySelector('.col-4');
      var subInfoDrawer = document.querySelector('.col-5');
      var subInfos = document.getElementsByClassName('sub-info');
      var subInfoId = [];

      $(".col-5 div").each( function() {
      	subInfoId.push($(this).attr("id"));
      });

      /* Open Sub Info Drawer with according information when Menu Item is clicked */
      for(var i=0; i < subInfos.length; i++){
      	subInfos[i].addEventListener('click', function(e) {
      		var currentElem = e.srcElement.id;
        	for (var x=0; x<subInfoId.length; x++) {
        		if (x != currentElem) {
        			hideElement(subInfoId[x]);
        		} else {
        			showElement(subInfoId[currentElem]);
        		}
        	}
        	if (!subInfoDrawer.classList.contains('open')) {
        		subInfoDrawer.classList.add('open');
        	}
            e.stopPropagation();
        });
      }

      /* Open the right Main Menu drawer when hamburger menu icon is clicked
      /* Close left Locations Search List drawer when right Main Menu drawer opens */
      menu.addEventListener('click', function(e) {
      	rightDrawer.classList.toggle('open');
      	if (subInfoDrawer.classList.contains('open')) {
      		subInfoDrawer.classList.remove('open');
      	}
        if (rightDrawer.classList.contains('open')) {
      	  listDrawer.classList.add('close');
      	 /* showElement('show-list');*/
        } else {
      	  listDrawer.classList.remove('close');
      	  /*hideElement('show-list');*/
        }
        e.stopPropagation();
      });

      /* Close the right Main Menu drawer and the Sub Info draer when hamburger menu icon is clicked */
      main.addEventListener('click', function() { // TODO: Needs to get another DOM element to click on
        rightDrawer.classList.remove('open');
        subInfoDrawer.classList.remove('open');
      });

      /* Reset drawers to default when Reset button in header is clicked */
      resetButton.addEventListener('click', function() {
      	hideElement('show-list');
      	listDrawer.classList.remove('close');
        poiDrawer.classList.remove('open');
        rightDrawer.classList.remove('open');
        subInfoDrawer.classList.remove('open');
      });

    </script>
  </body>
</html>